<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Listagem de Consultas</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
      .badge-agendada { background-color: #17a2b8; }
      .badge-concluida { background-color: #28a745; }
      .badge-cancelada { background-color: #dc3545; }
      .alert { margin-top: 20px; }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div class="row mb-4">
        <div class="col">
          <h1>
            <i class="fas fa-calendar-check"></i> Listagem de Consultas
          </h1>
        </div>
        <div class="col text-right">
          <a href="/consultas/agendar" class="btn btn-primary">
            <i class="fas fa-plus"></i> Agendar Nova Consulta
          </a>
          <a href="/" class="btn btn-secondary">
            <i class="fas fa-home"></i> Início
          </a>
        </div>
      </div>

      <!-- Mensagens de Feedback -->
      <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> <span th:text="${mensagemSucesso}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div th:if="${mensagemErro}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle"></i> <span th:text="${mensagemErro}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <!-- Filtros por Status -->
      <div class="btn-group mb-3" role="group">
        <a href="/consultas" class="btn btn-outline-secondary">
          <i class="fas fa-list"></i> Todas
        </a>
        <a href="/consultas/status/agendada" class="btn btn-outline-info">
          <i class="fas fa-clock"></i> Agendadas
        </a>
        <a href="/consultas/status/concluida" class="btn btn-outline-success">
          <i class="fas fa-check"></i> Concluídas
        </a>
        <a href="/consultas/status/cancelada" class="btn btn-outline-danger">
          <i class="fas fa-times"></i> Canceladas
        </a>
      </div>

      <!-- Tabela de Consultas -->
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="thead-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Paciente</th>
              <th scope="col">Médico</th>
              <th scope="col">Data/Hora</th>
              <th scope="col">Status</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr th:if="${#lists.isEmpty(consultasList)}">
              <td colspan="6" class="text-center text-muted">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>Nenhuma consulta encontrada</p>
              </td>
            </tr>
            <tr th:each="consulta : ${consultasList}">
              <th scope="row" th:text="${consulta.id}"></th>
              <td>
                <strong th:text="${consulta.pacienteNome}"></strong><br/>
                <small class="text-muted" th:text="${consulta.pacienteEmail}"></small>
              </td>
              <td>
                <span th:text="${consulta.medico.nome}"></span><br/>
                <small class="text-muted" th:text="${consulta.medico.especialidade}"></small>
              </td>
              <td>
                <i class="far fa-calendar"></i>
                <span th:text="${#temporals.format(consulta.horario.dataHora, 'dd/MM/yyyy HH:mm')}"></span>
              </td>
              <td>
                <span th:if="${consulta.status.name() == 'AGENDADA'}" 
                      class="badge badge-agendada">
                  <i class="fas fa-clock"></i> Agendada
                </span>
                <span th:if="${consulta.status.name() == 'CONCLUIDA'}" 
                      class="badge badge-concluida">
                  <i class="fas fa-check"></i> Concluída
                </span>
                <span th:if="${consulta.status.name() == 'CANCELADA'}" 
                      class="badge badge-cancelada">
                  <i class="fas fa-times"></i> Cancelada
                </span>
              </td>
              <td>
                <div class="btn-group" role="group">
                  <a th:href="@{/consultas/detalhes/{id}(id=${consulta.id})}" 
                     class="btn btn-sm btn-info" 
                     title="Ver Detalhes">
                    <i class="fas fa-eye"></i>
                  </a>
                  
                  <a th:href="@{/consultas/edit/{id}(id=${consulta.id})}" 
                     class="btn btn-sm btn-warning"
                     th:if="${consulta.status.name() == 'AGENDADA'}"
                     title="Editar">
                    <i class="fas fa-edit"></i>
                  </a>
                  
                  <a th:href="@{/consultas/concluir/{id}(id=${consulta.id})}" 
                     class="btn btn-sm btn-success"
                     th:if="${consulta.status.name() == 'AGENDADA'}"
                     onclick="return confirm('Deseja marcar esta consulta como concluída?')"
                     title="Concluir">
                    <i class="fas fa-check"></i>
                  </a>
                  
                  <a th:href="@{/consultas/cancelar/{id}(id=${consulta.id})}" 
                     class="btn btn-sm btn-danger"
                     th:if="${consulta.status.name() == 'AGENDADA'}"
                     onclick="return confirm('Deseja cancelar esta consulta? O horário ficará disponível novamente.')"
                     title="Cancelar">
                    <i class="fas fa-ban"></i>
                  </a>
                  
                  <a th:href="@{/consultas/delete/{id}(id=${consulta.id})}" 
                     class="btn btn-sm btn-dark"
                     onclick="return confirm('ATENÇÃO: Esta ação irá excluir permanentemente a consulta. Deseja continuar?')"
                     title="Excluir">
                    <i class="fas fa-trash"></i>
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Informações Adicionais -->
      <div class="row mt-4">
        <div class="col-md-4">
          <div class="card text-white bg-info">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-clock"></i> Agendadas
              </h5>
              <h2 th:text="${#lists.size(consultasList.?[status.name() == 'AGENDADA'])}"></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-success">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-check"></i> Concluídas
              </h5>
              <h2 th:text="${#lists.size(consultasList.?[status.name() == 'CONCLUIDA'])}"></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-danger">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-times"></i> Canceladas
              </h5>
              <h2 th:text="${#lists.size(consultasList.?[status.name() == 'CANCELADA'])}"></h2>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  </body>
</html>